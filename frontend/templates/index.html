{% extends "base.html" %}

{% block content %}
<!-- ヒーローセクション -->
<div class="hero-section text-white text-center py-5 mb-5" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #8e44ad 100%); border-radius: 15px;">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3">モロッコへようこそ</h1>
        <p class="lead mb-4">魅力的な観光地、美しい風景、豊かな文化を発見しましょう</p>
        
        <!-- 検索バー -->
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="input-group input-group-lg">
                    <input type="text" class="form-control" placeholder="観光地、都市名を検索..." id="searchInput" onkeypress="if(event.key==='Enter') searchSpots()">
                    <button class="btn btn-warning px-4" type="button" onclick="searchSpots()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- クイックアクセス -->
    <div class="row mb-5">
        <div class="col-12 text-center mb-4">
            <h2 class="h3 text-primary">クイックアクセス</h2>
            <p class="text-muted">モロッコ観光を始めましょう</p>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('spots') }}" class="card text-decoration-none h-100 hover-card">
                <div class="card-body text-center">
                    <i class="fas fa-map-marker-alt fa-3x text-danger mb-3"></i>
                    <h5 class="card-title">観光地一覧</h5>
                    <p class="card-text text-muted">人気スポットを探す</p>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('map_page') }}" class="card text-decoration-none h-100 hover-card">
                <div class="card-body text-center">
                    <i class="fas fa-map fa-3x text-success mb-3"></i>
                    <h5 class="card-title">マップ</h5>
                    <p class="card-text text-muted">地図で場所を確認</p>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('ai_chat_page') }}" class="card text-decoration-none h-100 hover-card">
                <div class="card-body text-center">
                    <i class="fas fa-robot fa-3x text-primary mb-3"></i>
                    <h5 class="card-title">AIチャット</h5>
                    <p class="card-text text-muted">観光相談をする</p>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <a href="{{ url_for('settings') }}" class="card text-decoration-none h-100 hover-card">
                <div class="card-body text-center">
                    <i class="fas fa-cog fa-3x text-warning mb-3"></i>
                    <h5 class="card-title">設定</h5>
                    <p class="card-text text-muted">言語・音声設定</p>
                </div>
            </a>
        </div>
    </div>

    <!-- おすすめ観光地 -->
    <div class="row mb-5">
        <div class="col-12 mb-4">
            <h2 class="h3 text-primary">おすすめ観光地</h2>
            <p class="text-muted">モロッコで人気の観光スポット</p>
        </div>
        <div id="recommendedSpots" class="row">
            <!-- 動的に読み込まれます -->
        </div>
    </div>

    <!-- カテゴリー別観光地 -->
    <div class="row mb-5">
        <div class="col-12 mb-4">
            <h2 class="h3 text-primary">カテゴリー別に探す</h2>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card category-card h-100" onclick="filterByCategory('宗教建築')">
                <div class="card-body text-center">
                    <i class="fas fa-mosque fa-2x text-primary mb-3"></i>
                    <h6 class="fw-bold">宗教建築</h6>
                    <small class="text-muted">モスク、マドラサ</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card category-card h-100" onclick="filterByCategory('自然')">
                <div class="card-body text-center">
                    <i class="fas fa-mountain fa-2x text-success mb-3"></i>
                    <h6 class="fw-bold">自然・景観</h6>
                    <small class="text-muted">砂漠、山脈</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card category-card h-100" onclick="filterByCategory('広場・市場')">
                <div class="card-body text-center">
                    <i class="fas fa-store fa-2x text-danger mb-3"></i>
                    <h6 class="fw-bold">広場・市場</h6>
                    <small class="text-muted">スーク、広場</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card category-card h-100" onclick="filterByCategory('歴史建築')">
                <div class="card-body text-center">
                    <i class="fas fa-university fa-2x text-warning mb-3"></i>
                    <h6 class="fw-bold">歴史建築</h6>
                    <small class="text-muted">宮殿、建造物</small>
                </div>
            </div>
        </div>
    </div>

    <!-- 現地情報 -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title text-info">
                        <i class="fas fa-info-circle me-2"></i>基本情報
                    </h5>
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <i class="fas fa-coins text-warning mb-2"></i>
                            <div class="small text-muted">通貨</div>
                            <div class="fw-bold">ディルハム</div>
                        </div>
                        <div class="col-6 mb-3">
                            <i class="fas fa-language text-primary mb-2"></i>
                            <div class="small text-muted">言語</div>
                            <div class="fw-bold">アラビア語</div>
                        </div>
                        <div class="col-6">
                            <i class="fas fa-clock text-success mb-2"></i>
                            <div class="small text-muted">時差</div>
                            <div class="fw-bold">-8時間</div>
                        </div>
                        <div class="col-6">
                            <i class="fas fa-thermometer-half text-danger mb-2"></i>
                            <div class="small text-muted">気候</div>
                            <div class="fw-bold">乾燥〜温暖</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title text-success">
                        <i class="fas fa-route me-2"></i>旅行プラン
                    </h5>
                    <p class="card-text">AIがあなたにぴったりの旅行プランを提案します。</p>
                    <div class="d-grid">
                        <a href="{{ url_for('ai_chat_page') }}" class="btn btn-success">
                            <i class="fas fa-magic me-2"></i>プラン作成開始
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadRecommendedSpots();
});

function loadRecommendedSpots() {
    // APIからおすすめ観光地データを取得
    fetch('/api/spots/recommended')
        .then(response => {
            if (!response.ok) {
                throw new Error('おすすめ観光地データの取得に失敗しました');
            }
            return response.json();
        })
        .then(spots => {
            displayRecommendedSpots(spots);
        })
        .catch(error => {
            console.error('Error loading recommended spots:', error);
            showRecommendedError();
        });
}

function showRecommendedError() {
    const container = document.getElementById('recommendedSpots');
    container.innerHTML = `
        <div class="col-12">
            <div class="alert alert-warning text-center">
                <h6><i class="fas fa-exclamation-triangle me-2"></i>おすすめ観光地を取得できませんでした</h6>
                <p class="small mb-2">データの読み込みに失敗しました。しばらく時間をおいて再度お試しください。</p>
                <button class="btn btn-sm btn-primary" onclick="loadRecommendedSpots()">再読み込み</button>
            </div>
        </div>
    `;
}
}

function displayRecommendedSpots(spots) {
    const container = document.getElementById('recommendedSpots');
    container.innerHTML = '';
    
    spots.forEach(spot => {
        const spotCard = `
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 hover-card">
                    <div class="card-body">
                        <h5 class="card-title">${spot.name}</h5>
                        <p class="card-text text-muted small">
                            <i class="fas fa-map-marker-alt text-primary me-1"></i>
                            ${spot.city} · ${spot.category}
                            ${spot.verified ? '<i class="fas fa-check-circle text-success ms-2" title="公式認定スポット"></i>' : ''}
                        </p>
                        <p class="card-text">${spot.description}</p>
                        <div class="mb-2">
                            <span class="badge bg-info">信頼できる観光地</span>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent">
                        <button class="btn btn-outline-primary btn-sm" onclick="viewSpotDetail(${spot.id})">
                            詳細を見る
                        </button>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML += spotCard;
    });
}

function searchSpots() {
    const query = document.getElementById('searchInput').value.trim();
    if (query) {
        window.location.href = `/spots?search=${encodeURIComponent(query)}`;
    }
}

function filterByCategory(category) {
    window.location.href = `/spots?category=${encodeURIComponent(category)}`;
}

function viewSpotDetail(spotId) {
    window.location.href = `/spots/${spotId}`;
}
</script>

<style>
.hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: none;
    border-radius: 15px;
    overflow: hidden;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    text-decoration: none;
}

.category-card {
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.hero-section {
    background-attachment: fixed;
    background-size: cover;
    background-position: center;
}

.card-footer {
    border-top: none;
}
</style>
{% endblock %}