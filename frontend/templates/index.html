{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="col-12 mb-4">
        <div class="hero-section bg-gradient p-5 rounded text-white text-center">
            <h1 class="display-4 mb-3">ğŸ‡²ğŸ‡¦ ãƒ¢ãƒ­ãƒƒã‚³ã¸ã‚ˆã†ã“ã</h1>
            <p class="lead">é­…åŠ›çš„ãªè¦³å…‰åœ°ã€ç¾ã—ã„é¢¨æ™¯ã€è±Šã‹ãªæ–‡åŒ–ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†</p>
            <div class="row mt-4">
                <div class="col-md-8 mx-auto">
                    <div class="input-group">
                        <input type="text" class="form-control form-control-lg" placeholder="è¦³å…‰åœ°ã‚’æ¤œç´¢..." id="searchInput">
                        <button class="btn btn-warning btn-lg" type="button" onclick="searchSpots()">
                            <i class="fas fa-search"></i> æ¤œç´¢
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ãŠã™ã™ã‚è¦³å…‰åœ° -->
    <div class="col-lg-8">
        <h3><i class="fas fa-star text-warning"></i> ãŠã™ã™ã‚è¦³å…‰åœ°</h3>
        <div class="row" id="recommendedSpots">
            <!-- å‹•çš„ã«èª­ã¿è¾¼ã¿ -->
        </div>
        
        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥è¡¨ç¤º -->
        <div class="mt-4">
            <h4>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã«æ¢ã™</h4>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <div class="card category-card" onclick="filterByCategory('historical')">
                        <div class="card-body text-center">
                            <i class="fas fa-mosque fa-3x text-primary mb-2"></i>
                            <h6>æ­´å²çš„å»ºé€ ç‰©</h6>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card category-card" onclick="filterByCategory('nature')">
                        <div class="card-body text-center">
                            <i class="fas fa-mountain fa-3x text-success mb-2"></i>
                            <h6>è‡ªç„¶ãƒ»æ™¯è¦³</h6>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card category-card" onclick="filterByCategory('market')">
                        <div class="card-body text-center">
                            <i class="fas fa-shopping-bag fa-3x text-warning mb-2"></i>
                            <h6>ãƒãƒ¼ã‚±ãƒƒãƒˆ</h6>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card category-card" onclick="filterByCategory('culture')">
                        <div class="card-body text-center">
                            <i class="fas fa-palette fa-3x text-info mb-2"></i>
                            <h6>æ–‡åŒ–ãƒ»èŠ¸è¡“</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <div class="col-lg-4">
        <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ -->
        <div class="card mb-3">
            <div class="card-header">
                <h5><i class="fas fa-rocket"></i> ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('chat') }}" class="btn btn-primary">
                        <i class="fas fa-robot"></i> AIè¦³å…‰æ¡ˆå†…
                    </a>
                    <a href="{{ url_for('routes') }}" class="btn btn-success">
                        <i class="fas fa-route"></i> ãŠã™ã™ã‚ãƒ«ãƒ¼ãƒˆ
                    </a>
                    <button class="btn btn-info" onclick="showMap()">
                        <i class="fas fa-map"></i> åœ°å›³ã‚’è¡¨ç¤º
                    </button>
                </div>
            </div>
        </div>

        <!-- ç¾åœ°æƒ…å ± -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> ç¾åœ°æƒ…å ±</h5>
            </div>
            <div class="card-body">
                <p><strong>é€šè²¨:</strong> ãƒ¢ãƒ­ãƒƒã‚³ãƒ»ãƒ‡ã‚£ãƒ«ãƒãƒ  (MAD)</p>
                <p><strong>è¨€èª:</strong> ã‚¢ãƒ©ãƒ“ã‚¢èªã€ãƒ™ãƒ«ãƒ™ãƒ«èªã€ãƒ•ãƒ©ãƒ³ã‚¹èª</p>
                <p><strong>æ™‚å·®:</strong> æ—¥æœ¬ã‚ˆã‚Š8æ™‚é–“é…ã‚Œ</p>
                <p><strong>æ°—å€™:</strong> åœ°ä¸­æµ·æ€§æ°—å€™ã€œç ‚æ¼ æ°—å€™</p>
                <a href="{{ url_for('info') }}" class="btn btn-outline-primary btn-sm">è©³ç´°ã‚’è¦‹ã‚‹</a>
            </div>
        </div>
    </div>
</div>

<!-- ãƒãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal fade" id="mapModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ãƒ¢ãƒ­ãƒƒã‚³è¦³å…‰ãƒãƒƒãƒ—</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="map" style="height: 500px;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadRecommendedSpots();
});

function loadRecommendedSpots() {
    fetch('/api/spots/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displaySpots(data.data);
            }
        })
        .catch(error => console.error('Error:', error));
}

function displaySpots(spots) {
    const container = document.getElementById('recommendedSpots');
    container.innerHTML = '';
    
    spots.forEach(spot => {
        const spotCard = `
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="card-title">${spot.name}</h6>
                        <p class="card-text text-muted small">${spot.city} Â· ${spot.category}</p>
                        <p class="card-text">${spot.description}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-warning">
                                ${'â˜…'.repeat(Math.floor(spot.rating))} ${spot.rating}
                            </small>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewSpotDetail(${spot.id})">
                                è©³ç´°
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML += spotCard;
    });
}

function searchSpots() {
    const query = document.getElementById('searchInput').value;
    // æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…
    console.log('Searching for:', query);
}

function filterByCategory(category) {
    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å®Ÿè£…
    console.log('Filtering by category:', category);
}

function viewSpotDetail(spotId) {
    window.location.href = `/spots/${spotId}`;
}

function showMap() {
    const mapModal = new bootstrap.Modal(document.getElementById('mapModal'));
    mapModal.show();
    // åœ°å›³ã®åˆæœŸåŒ–ï¼ˆGoogle Maps APIä½¿ç”¨æ™‚ï¼‰
}
</script>
{% endblock %}