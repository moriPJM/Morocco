{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- ヒーローセクション -->
    <div class="col-12 mb-5">
        <div class="hero-section p-5 rounded text-white text-center" style="background: #e74c3c !important; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #8e44ad 100%) !important; color: white !important; min-height: 300px;">
            <h1 class="display-3 mb-4 fw-bold text-white" style="color: white !important; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">モロッコへようこそ</h1>
            <p class="lead fs-4 mb-4 text-white" style="color: white !important; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">魅力的な観光地、美しい風景、豊かな文化を発見しましょう</p>
            <div class="row mt-4">
                <div class="col-lg-6 mx-auto">
                    <div class="input-group input-group-lg shadow">
                        <input type="text" class="form-control border-0" placeholder="観光地、都市名を検索..." id="searchInput" style="color: #333 !important; background-color: white !important;">
                        <button class="btn btn-warning px-4" type="button" onclick="searchSpots()" style="color: white !important;">
                            <i class="fas fa-search me-2"></i> 検索
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- おすすめ観光地 -->
    <div class="col-lg-8">
        <div class="mb-4">
            <h3 class="h2 mb-3 text-dark">
                <i class="fas fa-star text-warning me-2"></i>
                おすすめ観光地
            </h3>
            <p class="text-muted">モロッコで最も人気の観光スポットをご紹介</p>
        </div>
        
        <div class="row" id="recommendedSpots">
            <!-- 動的に読み込み -->
        </div>
        
        <!-- カテゴリー別表示 -->
        <div class="mt-5">
            <h4 class="h3 mb-4 text-dark">カテゴリー別に探す</h4>
            <div class="row g-3">
                <div class="col-md-3 col-sm-6">
                    <div class="card category-card h-100 border-0 shadow-sm" onclick="filterByCategory('historical')">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-mosque fa-3x text-primary mb-3"></i>
                            <h6 class="fw-bold text-dark">歴史的建造物</h6>
                            <small class="text-muted">モスク、宮殿、遺跡</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card category-card h-100 border-0 shadow-sm" onclick="filterByCategory('nature')">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-mountain fa-3x text-success mb-3"></i>
                            <h6 class="fw-bold text-dark">自然・景観</h6>
                            <small class="text-muted">砂漠、山脈、海岸</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card category-card h-100 border-0 shadow-sm" onclick="filterByCategory('market')">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-shopping-bag fa-3x text-warning mb-3"></i>
                            <h6 class="fw-bold text-dark">マーケット</h6>
                            <small class="text-muted">スーク、バザール</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card category-card h-100 border-0 shadow-sm" onclick="filterByCategory('culture')">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-palette fa-3x text-info mb-3"></i>
                            <h6 class="fw-bold text-dark">文化・芸術</h6>
                            <small class="text-muted">博物館、ギャラリー</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- サイドバー -->
    <div class="col-lg-4">
        <!-- クイックアクセス -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-0 pb-2">
                <h5 class="mb-0 text-dark">
                    <i class="fas fa-rocket text-primary me-2"></i>
                    クイックアクセス
                </h5>
            </div>
            <div class="card-body pt-2">
                <div class="d-grid gap-3">
                    <a href="{{ url_for('chat') }}" class="btn btn-primary btn-lg">
                        <i class="fas fa-robot me-2"></i> AI観光案内
                    </a>
                    <a href="{{ url_for('routes') }}" class="btn btn-success btn-lg">
                        <i class="fas fa-route me-2"></i> おすすめルート
                    </a>
                    <button class="btn btn-info btn-lg" onclick="showMap()">
                        <i class="fas fa-map me-2"></i> 地図を表示
                    </button>
                </div>
            </div>
        </div>

        <!-- 現地情報 -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 pb-2">
                <h5 class="mb-0 text-dark">
                    <i class="fas fa-info-circle text-info me-2"></i>
                    現地情報
                </h5>
            </div>
            <div class="card-body pt-2">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="text-center p-2">
                            <i class="fas fa-coins text-warning mb-2"></i>
                            <div class="small text-muted">通貨</div>
                            <div class="fw-bold small text-dark">モロッコ・ディルハム</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-2">
                            <i class="fas fa-language text-primary mb-2"></i>
                            <div class="small text-muted">言語</div>
                            <div class="fw-bold small text-dark">アラビア語・フランス語</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-2">
                            <i class="fas fa-clock text-success mb-2"></i>
                            <div class="small text-muted">時差</div>
                            <div class="fw-bold small text-dark">日本より8時間遅れ</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-2">
                            <i class="fas fa-thermometer-half text-danger mb-2"></i>
                            <div class="small text-muted">気候</div>
                            <div class="fw-bold small text-dark">地中海性〜砂漠性</div>
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <a href="{{ url_for('info') }}" class="btn btn-outline-primary">
                        <i class="fas fa-external-link-alt me-1"></i>
                        詳細を見る
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- マップモーダル -->
<div class="modal fade" id="mapModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">モロッコ観光マップ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="map" style="height: 500px;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadRecommendedSpots();
});

function loadRecommendedSpots() {
    fetch('/api/spots/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displaySpots(data.data);
            }
        })
        .catch(error => console.error('Error:', error));
}

function displaySpots(spots) {
    const container = document.getElementById('recommendedSpots');
    container.innerHTML = '';
    
    spots.forEach((spot, index) => {
        const spotCard = `
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm" style="animation-delay: ${0.1 * (index + 1)}s">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="card-title fw-bold mb-0 text-dark">${spot.name}</h6>
                            <button class="btn btn-outline-danger btn-sm" onclick="toggleFavorite(${spot.id})">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <p class="card-text text-muted small mb-2">
                            <i class="fas fa-map-marker-alt text-primary me-1"></i>
                            ${spot.city} · ${spot.category}
                        </p>
                        <p class="card-text text-dark">${spot.description}</p>
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="text-warning">
                                ${'★'.repeat(Math.floor(spot.rating))}${'☆'.repeat(5-Math.floor(spot.rating))}
                                <span class="small text-muted ms-1">${spot.rating}</span>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewSpotDetail(${spot.id})">
                                <i class="fas fa-info-circle me-1"></i>
                                詳細
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML += spotCard;
    });
}

function searchSpots() {
    const query = document.getElementById('searchInput').value;
    // 検索機能の実装
    console.log('Searching for:', query);
}

function filterByCategory(category) {
    // カテゴリーフィルターの実装
    console.log('Filtering by category:', category);
}

function viewSpotDetail(spotId) {
    window.location.href = `/spots#${spotId}`;
}

function toggleFavorite(spotId) {
    // お気に入り機能の実装
    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    const index = favorites.indexOf(spotId.toString());
    
    if (index === -1) {
        favorites.push(spotId.toString());
        showToast('お気に入りに追加しました！', 'success');
    } else {
        favorites.splice(index, 1);
        showToast('お気に入りから削除しました', 'info');
    }
    
    localStorage.setItem('favorites', JSON.stringify(favorites));
    loadRecommendedSpots(); // 表示を更新
}

function showToast(message, type = 'info') {
    // 簡易トースト通知
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close float-end" onclick="this.parentElement.remove()"></button>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 3000);
}

function showMap() {
    const mapModal = new bootstrap.Modal(document.getElementById('mapModal'));
    mapModal.show();
    // 地図の初期化（Google Maps API使用時）
}
</script>
{% endblock %}